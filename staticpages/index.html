<html>
    <head>

   </head>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
       
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
        <title> Coffeeexpress Consumers log </title>
    <body>
        <div id ="create-update" style="display:none">
            <h2>Create or update a Record</h2>
            <table class="table" id="createUpdateForm">
                <tr>
                    <td>Customer Id</td>
                    <td><input type ="text" name="ID" id="idInput"></td>
                </tr>
                <tr>
                    <td>Firstname</td>
                    <td><input type ="text" name="Firstname"></td>
                </tr>        
                <tr>
                    <td>Lastname</td>
                    <td><input type ="text" name="Lastname"></td>
                </tr>  
                <tr>
                    <td>Postcode</td>
                    <td><input type ="text" name="Postcode"></td>
                </tr> 
                <tr>
                    <td></td>
                        <td><button id="create-button" onClick="docreate()">Create</button></td>
                        <td><button id="update-button" onclick="doUpdate()">Update</button></td>
                </tr>
             </table>
        </div>
        <div id="display">
            <h2>Coffeeconsumers</h2>
            <button onClick ="showCreate()">Create a new consumer</button>
            <br><br>
            <table id ="consumertable" class ="table">
                <tr>
                    <th>customer ID</th><th>firstname</th><th>lastname</th><td>postcode</td>
                </tr>
                <tr ID="123">
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td><button onclick="showUpdate(this)">Update</button></td>
                    <td><button onclick="doDelete(this)">Delete</button></td>
                </tr> 
            </table>   
        </div>

        <script>
            function showCreate(){
                document.getElementById('display').style.display="none"
                document.getElementById('create-update').style.display="block"
            }
            function docreate(){
                console.log("in doCreate")
                coffeeconsumer= getcoffeeconsumerFromForm()
                $.ajax({
                    url:"http://127.0.0.1:5000/coffeeconsumers",
                    method:"POST",
                    data:JSON.stringify(coffeeconsumer),
                    dataType:"JSON",
                    contentType:"application/json;charset=utf-8",
                    success:function(result){
                        console.log(result)
                        addcoffeeconsumertoTable(coffeeconsumer)
                        showDisplay()
                    },
                    error:function(xhr,status,error){
                        console.log("error" +error)
                    }
                })
             } 
             function doDelete(thisElem){
                 var tableElement = document.getElementById('consumertable');
                 var rowElement = thisElem.parentNode.parentNode;
                 var index = rowElement.rowIndex;

                 ID = rowElement.getAttribute("id");
                 console.log(ID)
                 $.ajax({
                     url:"/coffeeconsumers/"+ID,
                     method:"DELETE",
                     data: "",
                     dateType:"JSON",
                     contentType:"application/json; charset=utf-8",
                     success:function(result){
                        //console.log()
                         tableElement.deleteRow(index);
                     },
                     error:function(xhr,status,error){
                         console.log("error "+error)
                        // console.log()
                     }
               })
             }
            function getcoffeeconsumerFromForm(){
                var form = document.getElementById('createUpdateForm')

                var coffeeconsumer = {}
                //coffeeconsumer.id = form.querySelector('input[name="Id"]').value
                coffeeconsumer.firstname = form.querySelector('input[name="Firstname"]').value
                coffeeconsumer.lastname = form.querySelector('input[name="Lastname"]').value
                coffeeconsumer.postcode = form.querySelector('input[name="Postcode"]').value
                console.log(coffeeconsumer)
                return coffeeconsumer
            }
            function showDisplay(){
                document.getElementById('display').style.display="block"
                document.getElementById('create-update').style.display="none"
            }
             function populateTable(){
                //ajax getAll[]
            coffeeconsumer = '';
                $.ajax({
                url:'http://127.0.0.1:5000/coffeeconsumers',
                method:'GET',
                data:'',
                datatype:'JSON',
                contentType:"application/json;charset=utf-8",
                success:function(results){
                    results.forEach(addcoffeeconsumertoTable);
                    //for (coffeeconsumer of results){
                        //addconsumerToTable(coffeeconsumer)
                    
                },
                    error:function(xhr,status,error){
                    console.log("error"+error +"code:"+status)
                }
                //coffeeconsumer = {
                   // id:369,
                    //firstname:"Carmel",
                    //lastname:"Conway",
                    //postcode:"F43K345"
                })     
                //addconsumerToTable(coffeeconsumer)
            }
            function addcoffeeconsumertoTable(coffeeconsumer){
                //console.log("working so far")
                tableElem = document.getElementById("consumertable")
                rowElem = tableElem.insertRow(-1)
                rowElem.setAttribute("id",coffeeconsumer.id)
                cell1=rowElem.insertCell(0)
                cell1.innerHTML =coffeeconsumer.id
                cell2=rowElem.insertCell(1)
                cell2.innerHTML =coffeeconsumer.firstname
                cell3=rowElem.insertCell(2)
                cell3.innerHTML =coffeeconsumer.lastname
                cell4=rowElem.insertCell(3)
                cell4.innerHTML =coffeeconsumer.postcode
                cell5=rowElem.insertCell(4)
                cell5.innerHTML ='<button onclick="showUpdate(this)">Update<button>'
                cell6=rowElem.insertCell(5)
                cell6.innerHTML ='<button onclick="doDelete(this)">delete<button>'


            }
            populateTable()
        </script>
    </body>
</html>  
        